#' make_repeat_summary
#'
#' Converts wide summary data into an allele-level repeat summary table.
#'
#' @param df_summary_wide Tibble with per-sample repeat info (output of make_summary_wide).
#' @return Tibble with one row per locus × sample × allele.
#' @export
make_repeat_summary <- function(df_summary_wide) {
  df_summary_wide %>%
    pivot_longer(
      cols = matches("allele[01]$"),
      names_to = c("metric", "allele"),
      names_pattern = "(.*)_allele(\\d+)"
    ) %>%
    pivot_wider(names_from = metric, values_from = value) %>%
    mutate(
      allele = as.integer(allele),
      repeat_size = as.numeric(consensus_size),
      read_count = as.numeric(read_count),
      allele_label = paste0("allele", allele)
    ) %>%
    relocate(locus, sample, allele, allele_label, repeat_size, read_count)
}
